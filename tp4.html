<!DOCTYPE html>
<html lang="en">
<head>
  <title>KILLS AUX STATES</title>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v3.min.js"></script>

<style type="text/css">

/* On mouse hover, lighten state color */
path:hover {
  fill-opacity: .7;
}
/* Style for Custom Tooltip */
div.tooltip {   
  position: absolute;           
  text-align: center;           
  width: 60px;                  
  height: 28px;                 
  padding: 2px;             
  font: 12px sans-serif;        
  background: white;   
  border: 0px;      
  border-radius: 8px;           
  pointer-events: none;         
}
        
/* Legend Font Style */
body {
  font: 11px sans-serif;
}
        
/* Legend Position Style */
.legend {
  position:absolute;
  left:800px;
  top:350px;
}

p1 {
  position:center;
}

</style>
</head>
<body>
  <h1 align="center">TUERIES DE MASSE AUX ETATS-UNIS</h1>
<script type="text/javascript">
    
//Width and height of map
var width = 960;
var height = 500;

// D3 Projection
var projection = d3.geo.albersUsa()
           .translate([width/2, height/2])    // translate to center of screen
           .scale([1000]);          // scale things down so see entire US
        
// Define path generator
var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
         .projection(projection);  // tell path generator to use albersUsa projection
    
// Define linear scale for output
/*var color = d3.scale.linear()
        .range(["rgb(213,222,217)","rgb(69,173,168)","rgb(84,36,55)","rgb(217,91,67)"]);*/

var color = d3.scale.linear()
        .range(["rgb(99,94,92)","rgb(255,0,0)","rgb(217,125,13)","rgb(250,226,45)"]);

var legendText = ["<5M people", ">5M people", ">10M people", ">20M people"];

//Create SVG element and append map to the SVG
var svg = d3.select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height);
        
// Append Div for tooltip to SVG
var div = d3.select("body")
        .append("div")   
        .attr("class", "tooltip")               
        .style("opacity", 0);

color.domain([0,1,2,3]); // setting the range of the input data

// Load GeoJSON data and merge with states data
d3.json("us-states.json", function(json) {

svg.selectAll("path")
  .data(json.features)
  .enter()
  .append("path")
  .attr("d", path)
  .style("stroke", "#666")  //fff sinon
  .style("stroke-width", "1")
  .style("fill", function(d) {

  // Get data value
  var value = d.properties.population;
  if (value > 20000000) {
    return color(0);
  }else if(value > 10000000){
    return color(1);
  }else if(value > 5000000){
    return color(2);
  }else{
    return color(3);
  }

})
  .on("mouseover", function(d) {      
      div.transition()        
           .duration(200)      
           .style("opacity", .9);      
           div.text(d.properties.name)
           .style("left", (d3.event.pageX) + "px")     
           .style("top", (d3.event.pageY) + "px");    
  })   ;


d3.csv("mass-shootings-in-america.csv", function(data){

svg.selectAll("circle")
  .data(data)
  .enter()
  .append("circle")
  .attr("cx", function(d) {
    return projection([d.Longitude, d.Latitude])[0];
  })
  .attr("cy", function(d) {
    return projection([d.Longitude, d.Latitude])[1];
  })
  .attr("r", function(d) {
    return Math.sqrt(d.TotalNumberOfVictims) * 3;
  })
    .style("fill", "rgb(217,91,67)")  
    .style("opacity", 0.75) 
  .on("mouseover", function(d) {      
      div.transition()        
           .duration(200)      
           .style("opacity", .99);      
           div.text(d.City + " " + d.TotalNumberOfVictims)
           .style("left", (d3.event.pageX) + "px")     
           .style("top", (d3.event.pageY - 28) + "px");    
  })   

    // fade out tooltip on mouse out               
    .on("mouseout", function(d) {       
        div.transition()        
           .duration(500)      
           .style("opacity", 0);   
    });
});  
        
// Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852
var legend = d3.select("body").append("svg")
            .attr("class", "legend")
          .attr("width", 140)
          .attr("height", 200)
          .selectAll("g")
          .data(color.domain().slice().reverse())
          .enter()
          .append("g")
          .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

    legend.append("rect")
        .attr("width", 18)
        .attr("height", 18)
        .style("fill", color);

    legend.append("text")
        .data(legendText)
          .attr("x", 24)
          .attr("y", 9)
          .attr("dy", ".35em")
          .text(function(d) { return d; });
  });

//------------------------------------------------------------------------


</script>
</body>
</html>